{% extends 'base/base.html' %} {% block head %}
{% endblock head %} {% block body %}

<div class="p-0 border rounded-3 offcanvas-container position-relative">
  <!-- Mobile Menu Toggle Button (Visible only on mobile) -->
  

  <div class="d-flex w-100">
    <!-- Custom In-Section Offcanvas (Mobile Only) -->
    {% include 'job_portal/side_bar.html' with page="register" %}
    <!-- Main Content Area -->
    <div class="px-4 py-4 flex-grow-1 right-content">
      <div class="form-container">
        <h2 class="mb-3 main-heading text-start">
            <button
                id="offcanvas-toggle-btn"
                class="btn btn-primary btn-sm d-lg-none  top-0 start-0 m-1 z-10"
                type="button"
              >
                <i class="bi bi-list me-1"></i>
              </button>
          {% if instance %}Update{% else %} Register {% endif %} Your Company
        </h2>
        <p class="text-start mb-4 text-muted">
          Company registration is required in order to post a job.
        </p>
        <form method="post" enctype="multipart/form-data" novalidate>
          {% csrf_token %} {% if form.non_field_errors %}
          <div class="alert alert-danger">{{ form.non_field_errors }}</div>
          {% endif %} {% for field in form %}
          <div class="mb-3">
            <label for="{{ field.id_for_label }}" class="form-label"
              >{{ field.label }}</label
            >
            {% if field.name == "logo" %}
            <div class="row">
              {% if form.instance.logo %}
              <div class="col-10">
                <input
                  type="file"
                  name="{{field.name}}"
                  class="form-control"
                  accept="image/*"
                  id="{{field.id_for_label}}"
                />
              </div>
              <div class="col-2">
                <div class="">
                  <!-- <p>Current Logo Preview:</p> -->
                  <img
                    src="{{ form.instance.logo.url }}"
                    alt="Current Logo"
                    style="max-width: 40px; height: auto"
                  />
                </div>
              </div>
              {% else %}
              <div class="col-auto">
                <input
                  type="file"
                  name="{{field.name}}"
                  class="form-control"
                  accept="image/*"
                  id="{{field.id_for_label}}"
                />
              </div>
              {% endif %}
            </div>
            <!-- {{ field }} -->

            {% else %} {{ field }} {% endif %} {% if field.errors %}
            <div class="text-danger small">{{ field.errors|striptags }}</div>
            {% endif %}
          </div>
          {% endfor %}

          <button type="submit" class="btn w-100">
            {% if instance %} Update Details {% else %} Register {% endif %}
          </button>

          {% if next %}
          <input type="hidden" name="next" value="{{ next }}" />
          {% endif %}
        </form>
      </div>
    </div>
  </div>
</div>
<script>
  function setupInSectionOffcanvas() {
    const sidebar = document.getElementById("sidebar-mobile");
    const toggleBtn = document.getElementById("offcanvas-toggle-btn");
    const closeBtn = document.getElementById("offcanvas-close-btn");

    const showSidebar = () => {
      // Only show on small screens (Bootstrap's lg breakpoint is 992px)
      if (window.innerWidth < 992) {
        sidebar.classList.add("show");
      }
    };
    const hideSidebar = () => sidebar.classList.remove("show");

    // Toggle button handler
    toggleBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      if (sidebar.classList.contains("show")) {
        hideSidebar();
      } else {
        showSidebar();
      }
    });

    // Close button handler
    closeBtn.addEventListener("click", hideSidebar);

    // Added a more reliable click-outside-of-menu handler
    document.addEventListener("click", (e) => {
      // Check if sidebar is open AND click target is not the sidebar itself AND not the toggle button
      if (
        sidebar.classList.contains("show") &&
        !sidebar.contains(e.target) &&
        e.target !== toggleBtn
      ) {
        hideSidebar();
      }
    });

    // Handle link clicks inside the sidebar (mock navigation)
    sidebar.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", (e) => {
        console.log(`Navigating to action: ${link.textContent.trim()}`);
        hideSidebar(); // Close menu after selection
      });
    });

    // Ensure sidebar is hidden if screen is resized to desktop size while open
    window.addEventListener("resize", () => {
      if (window.innerWidth >= 992) {
        hideSidebar();
      }
    });
  }

  // --- Initialization ---
  document.addEventListener("DOMContentLoaded", () => {
    setupInSectionOffcanvas();
  });
</script>
{% endblock body %}
